// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "debian-openssl-3.0.x", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Employee {
  id                 Int       @id @default(autoincrement())
  name               String    @db.VarChar(50)
  photo              String?   @db.VarChar(100)
  gender             String    @db.VarChar(10)
  dateOfBirth        DateTime  @map("date_of_birth") @db.Date
  maritalStatus      String    @map("marital_status") @db.VarChar(15)
  documentType       String    @map("document_type") @db.VarChar(30)
  documentNumber     String    @map("document_number") @db.VarChar(30)
  nif                String?   @unique @db.VarChar(20)
  socialSecurity     String?   @unique @map("social_security") @db.VarChar(20)
  dependents         Int       @default(0)
  educationDegree    String    @map("education_degree") @db.VarChar(50)
  phone1             String    @db.VarChar(15)
  phone2             String?   @db.VarChar(15)
  email              String    @unique @db.VarChar(50)
  userName           String?   @map("user_name") @db.VarChar(64)
  password           String?   @db.VarChar(64)
  canLogin           Boolean   @default(false) @map("can_login")
  role               String    @default("Normal")
  countryId          Int       @map("country_id")
  provinceId         Int?      @map("province_id")
  municipalityId     Int?      @map("municipality_id")
  residentialAddress String    @map("residential_address") @db.VarChar(150)
  position           String    @db.VarChar(50)
  baseSalary         Float?    @map("base_salary")
  hireDate           DateTime  @map("hire_date") @db.Date
  contractEndDate    DateTime? @map("contract_end_date") @db.Date
  bankName           String?   @map("bank_name") @db.VarChar(30)
  iban               String?   @unique @db.VarChar(30)
  accountNumber      String?   @map("account_number") @db.VarChar(30)
  createdById        Int?      @map("created_by_id")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedById        Int?      @map("updated_by_id")
  updatedAt          DateTime? @map("updated_at")

  country      Country       @relation(fields: [countryId], references: [id])
  province     Province?     @relation(fields: [provinceId], references: [id])
  municipality Municipality? @relation(fields: [municipalityId], references: [id])
  purchases    Purchase[]
  Sale         Sale[]

  employeePresences EmployeePresence[]
  transactions      Transaction[]
  cashRegisters     CashRegister[]
  insureds          Insured[]
  productSales      ProductSale[]

  @@unique([documentType, documentNumber])
  @@unique([bankName, accountNumber])
  @@map("tb_employees")
}

model EmployeePresence {
  id             Int       @id @default(autoincrement())
  employeeId     Int       @map("employee_id")
  date           DateTime  @db.Date()
  presenceStatus String    @map("presence_status")
  description    String?
  createdById    Int?      @map("created_by_id")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedById    Int?      @map("updated_by_id")
  updatedAt      DateTime? @map("updated_at")

  employee Employee @relation(fields: [employeeId], references: [id])

  @@unique([employeeId, date])
  @@map("tb_employee_presences")
}

model Country {
  id   Int    @id @default(autoincrement())
  name String @unique @db.VarChar(20)

  provinces Province[]
  employees Employee[]
  suppliers Supplier[]
  Ccstomers Customer[]

  @@map("tb_countries")
}

model Province {
  id        Int    @id @default(autoincrement())
  name      String @db.VarChar(50)
  countryId Int    @map("country_id")

  country        Country        @relation(fields: [countryId], references: [id])
  municipalities Municipality[]
  employees      Employee[]
  suppliers      Supplier[]
  customers      Customer[]

  @@unique([name, countryId])
  @@map("tb_provinces")
}

model Municipality {
  id         Int    @id @default(autoincrement())
  name       String @db.VarChar(50)
  provinceId Int    @map("province_id")

  provice   Province   @relation(fields: [provinceId], references: [id])
  employees Employee[]
  customers Customer[]

  @@unique([name, provinceId])
  @@map("tb_municipalities")
}

model Category {
  id          Int       @id @default(autoincrement())
  name        String    @unique @db.VarChar(50)
  createdById Int?      @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedById Int?      @map("updated_by_id")
  updatedAt   DateTime? @map("updated_at")

  products         Product[]
  purchases        Purchase[]
  supplierProducts SupplierProduct[]

  @@map("tb_categories")
}

model Product {
  id          Int       @id @default(autoincrement())
  name        String    @db.VarChar(70)
  barCode     String?   @unique @map("bar_code") @db.VarChar(70)
  photo       String?   @db.VarChar(100)
  categoryId  Int       @map("category_id")
  price       Float
  createdById Int?      @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedById Int?      @map("updated_by_id")
  updatedAt   DateTime? @map("updated_at")

  category         Category          @relation(fields: [categoryId], references: [id])
  purchases        Purchase[]
  supplierProducts SupplierProduct[]
  productSales     ProductSale[]

  @@unique([name, categoryId])
  @@map("tb_products")
}

model Supplier {
  id              Int       @id @default(autoincrement())
  name            String    @db.VarChar(50)
  representative  String    @db.VarChar(50)
  email           String    @unique @db.VarChar(50)
  phone           String    @unique @db.VarChar(15)
  photo           String?   @db.VarChar(100)
  countryId       Int       @map("country_id")
  provinceId      Int?      @map("province_id")
  municipalityId  Int?      @map("municipality_id")
  businessAddress String    @map("business_address") @db.VarChar(150)
  createdById     Int?      @map("created_by_id")
  createdAt       DateTime  @default(now()) @map("created_at")
  updatedById     Int?      @map("updated_by_id")
  updatedAt       DateTime? @map("updated_at")

  country          Country           @relation(fields: [countryId], references: [id])
  province         Province?         @relation(fields: [provinceId], references: [id])
  supplierProducts SupplierProduct[]
  purchases        Purchase[]

  @@map("tb_suppliers")
}

model SupplierProduct {
  id          Int       @id @default(autoincrement())
  supplierId  Int
  categoryId  Int       @map("category_id")
  productId   Int       @map("product_id")
  unitPrice   Float     @map("unit_price")
  createdById Int?      @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedById Int?      @map("updated_by_id")
  updatedAt   DateTime? @map("updated_at")

  supplier Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  category Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([supplierId, categoryId, productId])
  @@map("tb_supplier_products")
}

model Customer {
  id                 Int       @id @default(autoincrement())
  name               String    @db.VarChar(50)
  photo              String?   @db.VarChar(100)
  gender             String    @db.VarChar(10)
  dateOfBirth        DateTime? @map("date_of_birth") @db.Date
  phone              String?   @db.VarChar(15)
  email              String?   @unique @db.VarChar(50)
  countryId          Int?      @map("country_id")
  provinceId         Int?      @map("province_id")
  municipalityId     Int?      @map("municipality_id")
  residentialAddress String?   @map("residential_address") @db.VarChar(150)
  createdById        Int?      @map("created_by_id")
  createdAt          DateTime  @default(now()) @map("created_at")
  updatedById        Int?      @map("updated_by_id")
  updatedAt          DateTime? @map("updated_at")

  country      Country?      @relation(fields: [countryId], references: [id])
  province     Province?     @relation(fields: [provinceId], references: [id])
  municipality Municipality? @relation(fields: [municipalityId], references: [id])
  purchases    Purchase[]
  sales        Sale[]

  @@map("tb_customers")
}

model Purchase {
  id               Int       @id @default(autoincrement())
  photo            String?   @db.VarChar(100)
  lot              String?   @db.VarChar(70)
  barCode          String?   @map("bar_code") @db.VarChar(70)
  supplierId       Int       @map("supplier_id")
  categoryId       Int       @map("category_id")
  productId        Int       @map("product_id")
  color            String    @db.VarChar(20)
  size             String    @db.VarChar(20)
  unitPrice        Float     @map("unit_price")
  quantity         Int
  totalValue       Float     @map("total_value")
  paymentMethod    String    @map("payment_method")
  sellingPriceUnit Float     @default(0) @map("selling_price_unit")
  paid             Boolean
  purchaseDate     DateTime  @map("purchase_date") @db.Date()
  dueDate          DateTime? @map("due_date") @db.Date()
  employeeId       Int?      @map("employee_id")
  createdById      Int?      @map("created_by_id")
  createdAt        DateTime  @default(now()) @map("created_at")
  updatedById      Int?      @map("updated_by_id")
  updatedAt        DateTime? @map("updated_at")

  supplier      Supplier?      @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  category      Category?      @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  product       Product?       @relation(fields: [productId], references: [id], onDelete: Cascade)
  employee      Employee?      @relation(fields: [employeeId], references: [id], onDelete: SetNull)
  customer      Customer?      @relation(fields: [customerId], references: [id])
  customerId    Int?
  notifications Notification[]

  @@map("tb_purchases")
}

model Sale {
  id            Int       @id @default(autoincrement())
  customerId    Int?      @map("customer_id")
  totalValue    Float     @map("total_value")
  amountPaid    Float     @default(0) @map("amount_paid")
  discount      Float     @map("discount")
  employeeId    Int?      @map("employee_id")
  paymentMethod String    @map("payment_method") @db.VarChar(50)
  createdById   Int?      @map("created_by_id")
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedById   Int?      @map("updated_by_id")
  updatedAt     DateTime? @map("updated_at")

  customer     Customer?     @relation(fields: [customerId], references: [id])
  employee     Employee?     @relation(fields: [employeeId], references: [id])
  purchaseId   Int?
  productSales ProductSale[]

  @@map("tb_sales")
}

model ProductSale {
  id          Int       @id @default(autoincrement())
  productId   Int?      @map("product_id")
  saleId      Int?      @map("sale_id")
  quantity    Int
  totalValue  Float     @map("total_value")
  unitPrice   Float     @default(0) @map("unit_price")
  amountPaid  Float     @default(0) @map("amount_paid")
  color       String?
  size        String?
  discount    Float     @map("discount")
  employeeId  Int?      @map("employee_id")
  createdById Int?      @map("created_by_id")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedById Int?      @map("updated_by_id")
  updatedAt   DateTime? @map("updated_at")

  product  Product?  @relation(fields: [productId], references: [id])
  sale     Sale?     @relation(fields: [saleId], references: [id])
  employee Employee? @relation(fields: [employeeId], references: [id])

  @@map("tb_product_sales")
}

model Notification {
  id           Int       @id @default(autoincrement())
  notifiable   String    @db.VarChar(30)
  notifiableId Int       @map("notifiable_id")
  text         String
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedById  Int?      @map("updated_by_id")
  updatedAt    DateTime? @map("updated_at")

  stock Purchase @relation(fields: [notifiableId], references: [id])

  @@map("tb_notifications")
}

model CashRegister {
  id             Int       @id @default(autoincrement())
  initialBalance Decimal   @map("initial_balance") @db.Decimal(65, 3)
  balance        Decimal   @db.Decimal(65, 3)
  createdById    Int?      @map("created_by_id")
  createdAt      DateTime  @default(now()) @map("created_at")
  updatedById    Int?      @map("updated_by_id")
  updatedAt      DateTime? @map("updated_at")

  transactions Transaction[]
  createdBy    Employee?     @relation(fields: [createdById], references: [id])

  @@map("tb_cash_register")
}

model Transaction {
  id                  Int       @id @default(autoincrement())
  description         String
  operationType       String    @map("operation_type")
  amount              Decimal   @db.Decimal(65, 3)
  paymentMethod       String    @map("payment_method")
  date                DateTime
  cashRegisterId      Int       @map("cash_register_id")
  postMovementBalance Decimal   @default(0) @map("post_movement_balance") @db.Decimal(65, 3)
  createdById         Int?      @map("created_by_id")
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedById         Int?      @map("updated_by_id")
  updatedAt           DateTime? @map("updated_at")

  cashRegister CashRegister @relation(fields: [cashRegisterId], references: [id])
  createdBy    Employee?    @relation(fields: [createdById], references: [id])

  @@map("tb_transactions")
}

model Insured {
  id                Int       @id @default(autoincrement())
  name              String    @db.VarChar(50)
  policyholderId    Int?
  gender            String    @db.VarChar(10)
  maritalStatus     String?   @map("marital_status") @db.VarChar(15)
  cardName          String?   @map("card_name") @db.VarChar(50)
  cardNumber        String?   @map("card_number") @db.VarChar(20)
  dateOfBirth       DateTime  @map("date_of_birth")
  documentType      String    @map("document_type")
  documentNumber    String    @map("document_number")
  documentIssueDate DateTime? @map("document_issue_date")
  nif               String?   @db.VarChar(50)
  dependents        Int?      @default(0)
  occupation        String?   @db.VarChar(50)
  provinceId        Int?      @map("province_id")
  municipalityId    Int?      @map("municipality_id")
  address           String?
  neighborhood      String?
  email             String?   @db.VarChar(100)
  phone             String?   @db.VarChar(15)
  phone2            String?   @db.VarChar(15)
  comercial         String?   @db.VarChar(50)
  enrollmentDate    DateTime? @map("enrollment_date")
  renewalDate       DateTime? @map("renewal_date")
  plan              String?   @db.VarChar(50)
  policy            String?   @db.VarChar(50)
  proposalType      String?   @map("proposal_type") @db.VarChar(20)
  proposalNumber    String?   @map("proposal_number") @db.VarChar(25)
  proposalCurrency  String?   @map("proposal_currency") @db.VarChar(5)
  mediator          String?   @db.VarChar(50)
  policyNumber      String?   @map("policy_number") @db.VarChar(50)
  paymentFrequency  String?   @map("payment_frequency") @db.VarChar(15)
  paymentMethod     String?   @map("payment_method") @db.VarChar(30)
  student           String?
  relationship      String?   @db.VarChar(15)
  review            String?   @db.VarChar(15)
  createdAt         DateTime  @default(now()) @map("created_at")
  createdById       Int?      @map("created_by_id")
  updatedAt         DateTime? @updatedAt @map("updated_at")
  updatedById       Int?      @map("updated_by_id")

  createdBy     Employee?      @relation(fields: [createdById], references: [id])
  consultations Consultation[]
  policyholder  Insured?       @relation("insureds", fields: [policyholderId], references: [id])
  insureds      Insured[]      @relation("insureds")

  @@map("tb_insureds")
}

model Consultation {
  id              Int       @id @default(autoincrement())
  copaymentAmount Float?    @map("copayment_amount")
  paymentMethod   String    @map("payment_method") @db.VarChar(30)
  insuredId       Int       @map("insured_id")
  createdAt       DateTime  @default(now()) @map("created_at")
  createdById     Int?      @map("created_by_id")
  updatedAt       DateTime? @updatedAt @map("updated_at")
  updatedById     Int?      @map("updated_by_id")

  insured Insured @relation(fields: [insuredId], references: [id])

  @@map("tb_consultations")
}
